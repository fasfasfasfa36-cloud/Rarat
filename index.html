<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ! üéØ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        h1 {
            font-size: 32px;
            margin: 0 0 10px;
            text-align: center;
            background: linear-gradient(90deg, #0088cc, #ff4d4d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #category {
            font-size: 18px;
            color: var(--tg-theme-hint-color, #999);
            margin-bottom: 10px;
        }
        #hangman {
            width: 240px;
            height: 240px;
            margin: 20px 0;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));
        }
        #word {
            font-size: 42px;
            font-weight: bold;
            letter-spacing: 12px;
            margin: 20px 0;
            min-height: 60px;
            text-align: center;
        }
        #lives {
            font-size: 30px;
            margin: 15px 0;
        }
        #status {
            font-size: 24px;
            margin: 15px 0;
            font-weight: bold;
            min-height: 34px;
            text-align: center;
        }
        #keyboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 10px;
            max-width: 500px;
            width: 100%;
            margin: 20px 0;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .key {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 16px;
            border-radius: 16px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.2s;
            touch-action: manipulation;
            min-height: 50px;
        }
        .key:active {
            transform: scale(0.95);
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .key.correct {
            background: #4CAF50 !important;
            animation: pulse 0.6s;
        }
        .key.wrong {
            background: #f44336 !important;
            animation: shake 0.6s;
        }
        #scores {
            font-size: 20px;
            margin: 20px 0;
            padding: 12px 24px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 16px;
            text-align: center;
        }
        button {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 18px 36px;
            border-radius: 20px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
            margin: 20px;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        button:active {
            transform: scale(0.95);
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
        @keyframes shake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-12px); } 75% { transform: translateX(12px); } }
    </style>
</head>
<body>
    <h1>–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ! üéØ</h1>
    <div id="category"></div>
    <canvas id="hangman" width="240" height="240"></canvas>
    <div id="word"></div>
    <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div id="status">–í—ã–±–µ—Ä–∏ –±—É–∫–≤—É –Ω–∏–∂–µ üëá</div>
    <div id="keyboard"></div>
    <div id="scores">üèÜ –ü–æ–±–µ–¥—ã: 0 | üíî –ü–æ—Ä–∞–∂–µ–Ω–∏—è: 0 | üî• –°–µ—Ä–∏—è: 0 (—Ä–µ–∫–æ—Ä–¥: 0)</div>
    <button id="newGame">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>

    <script>
        let WebApp = window.Telegram?.WebApp;
        if (WebApp) {
            WebApp.ready();
            WebApp.expand();
        }

        const words = [
            {word: '–ö–û–¢', cat: '–ñ–∏–≤–æ—Ç–Ω–æ–µ'}, {word: '–°–û–ë–ê–ö–ê', cat: '–ñ–∏–≤–æ—Ç–Ω–æ–µ'}, {word: '–ü–¢–ò–¶–ê', cat: '–ñ–∏–≤–æ—Ç–Ω–æ–µ'}, {word: '–†–´–ë–ê', cat: '–ñ–∏–≤–æ—Ç–Ω–æ–µ'},
            {word: '–ú–ê–®–ò–ù–ê', cat: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç'}, {word: '–°–ê–ú–û–õ–Å–¢', cat: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç'}, {word: '–ü–û–ï–ó–î', cat: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç'}, {word: '–ö–û–†–ê–ë–õ–¨', cat: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç'},
            {word: '–î–û–ú', cat: '–ó–¥–∞–Ω–∏–µ'}, {word: '–®–ö–û–õ–ê', cat: '–ó–¥–∞–Ω–∏–µ'}, {word: '–ì–û–†–ê', cat: '–ü—Ä–∏—Ä–æ–¥–∞'}, {word: '–†–ï–ö–ê', cat: '–ü—Ä–∏—Ä–æ–¥–∞'},
            {word: '–°–û–õ–ù–¶–ï', cat: '–ü—Ä–∏—Ä–æ–¥–∞'}, {word: '–õ–£–ù–ê', cat: '–ü—Ä–∏—Ä–æ–¥–∞'}, {word: '–ó–í–ï–ó–î–ê', cat: '–ü—Ä–∏—Ä–æ–¥–∞'}, {word: '–î–ï–†–ï–í–û', cat: '–ü—Ä–∏—Ä–æ–¥–∞'},
            {word: '–ö–ù–ò–ì–ê', cat: '–ü—Ä–µ–¥–º–µ—Ç'}, {word: '–¢–ï–õ–ï–§–û–ù', cat: '–ü—Ä–µ–¥–º–µ—Ç'}, {word: '–õ–Æ–ë–û–í–¨', cat: '–≠–º–æ—Ü–∏—è'}, {word: '–î–†–£–ì', cat: '–ß–µ–ª–æ–≤–µ–∫'},
            {word: '–ò–ù–¢–ï–†–ù–ï–¢', cat: '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'}, {word: '–ò–ì–†–ê', cat: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ'}, {word: '–ë–û–¢', cat: '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'}, {word: '–ú–û–†–ï', cat: '–ü—Ä–∏—Ä–æ–¥–∞'}
        ];

        const canvas = document.getElementById('hangman');
        const ctx = canvas.getContext('2d');
        const wordDiv = document.getElementById('word');
        const livesDiv = document.getElementById('lives');
        const statusDiv = document.getElementById('status');
        const keyboardDiv = document.getElementById('keyboard');
        const categoryDiv = document.getElementById('category');
        const scoresDiv = document.getElementById('scores');
        const newGameBtn = document.getElementById('newGame');

        let currentWordObj = null;
        let guessedLetters = new Set();
        let lives = 6;
        let scores = JSON.parse(localStorage.getItem('hangman_scores_v4')) || { wins: 0, losses: 0, bestStreak: 0 };
        let currentStreak = 0;

        const russianLetters = '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø'.split('');

        function updateScores() {
            scoresDiv.textContent = `üèÜ –ü–æ–±–µ–¥—ã: ${scores.wins} | üíî –ü–æ—Ä–∞–∂–µ–Ω–∏—è: ${scores.losses} | üî• –°–µ—Ä–∏—è: ${currentStreak} (—Ä–µ–∫–æ—Ä–¥: ${scores.bestStreak})`;
            localStorage.setItem('hangman_scores_v4', JSON.stringify(scores));
        }

        function drawHangman() {
            ctx.clearRect(0, 0, 240, 240);
            ctx.strokeStyle = 'var(--tg-theme-text-color, #000)';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';

            ctx.beginPath();
            ctx.moveTo(20, 220); ctx.lineTo(220, 220); ctx.lineTo(200, 200); ctx.lineTo(40, 200); ctx.lineTo(20, 220);
            ctx.moveTo(70, 200); ctx.lineTo(70, 20); ctx.lineTo(180, 20); ctx.lineTo(180, 60);
            ctx.stroke();

            if (lives < 6) { ctx.beginPath(); ctx.arc(180, 80, 20, 0, Math.PI*2); ctx.stroke(); }
            if (lives < 5) { ctx.beginPath(); ctx.moveTo(180, 100); ctx.lineTo(180, 150); ctx.stroke(); }
            if (lives < 4) { ctx.beginPath(); ctx.moveTo(180, 110); ctx.lineTo(150, 130); ctx.stroke(); }
            if (lives < 3) { ctx.beginPath(); ctx.moveTo(180, 110); ctx.lineTo(210, 130); ctx.stroke(); }
            if (lives < 2) { ctx.beginPath(); ctx.moveTo(180, 150); ctx.lineTo(150, 190); ctx.stroke(); }
            if (lives < 1) { ctx.beginPath(); ctx.moveTo(180, 150); ctx.lineTo(210, 190); ctx.stroke(); }
        }

        function updateWordDisplay() {
            wordDiv.textContent = currentWordObj.word.split('').map(l => guessedLetters.has(l) ? l : '_').join(' ');
        }

        function updateLives() {
            livesDiv.textContent = '‚ù§Ô∏è'.repeat(lives) + 'üñ§'.repeat(6 - lives);
        }

        function createKeyboard() {
            keyboardDiv.innerHTML = '';
            russianLetters.forEach(letter => {
                const btn = document.createElement('button');
                btn.classList.add('key');
                btn.textContent = letter;
                btn.onclick = () => guessLetter(letter);
                keyboardDiv.appendChild(btn);
            });
        }

        function guessLetter(letter) {
            if (guessedLetters.has(letter) || lives === 0 || currentWordObj.word.split('').every(l => guessedLetters.has(l))) return;

            guessedLetters.add(letter);
            const buttons = keyboardDiv.querySelectorAll('.key');
            const idx = russianLetters.indexOf(letter);
            buttons[idx].disabled = true;
            buttons[idx].style.opacity = '0.6';

            if (currentWordObj.word.includes(letter)) {
                buttons[idx].classList.add('correct');
                updateWordDisplay();
                if (currentWordObj.word.split('').every(l => guessedLetters.has(l))) {
                    statusDiv.textContent = 'üéâ –ü–æ–±–µ–¥–∞! –ö—Ä—É—Ç–æ!';
                    scores.wins++;
                    currentStreak++;
                    if (currentStreak > scores.bestStreak) scores.bestStreak = currentStreak;
                    updateScores();
                }
            } else {
                buttons[idx].classList.add('wrong');
                lives--;
                updateLives();
                drawHangman();
                if (lives === 0) {
                    statusDiv.textContent = `üò≠ –ü—Ä–æ–∏–≥—Ä–∞–ª! –°–ª–æ–≤–æ: ${currentWordObj.word}`;
                    scores.losses++;
                    currentStreak = 0;
                    updateScores();
                } else {
                    statusDiv.textContent = `‚ùå –ù–µ–≤–µ—Ä–Ω–æ! –û—Å—Ç–∞–ª–æ—Å—å ${lives} ‚ù§Ô∏è`;
                }
            }
        }

        function newGame() {
            currentWordObj = words[Math.floor(Math.random() * words.length)];
            categoryDiv.textContent = `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${currentWordObj.cat}`;
            guessedLetters = new Set();
            lives = 6;
            statusDiv.textContent = '–í—ã–±–µ—Ä–∏ –±—É–∫–≤—É –Ω–∏–∂–µ üëá';
            wordDiv.textContent = '_ '.repeat(currentWordObj.word.length).trim();
            updateLives();
            drawHangman();
            createKeyboard();
            updateScores();
        }

        newGameBtn.onclick = newGame;
        updateScores();
        newGame(); // –ì–ª–∞–≤–Ω–æ–µ ‚Äî –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã!
    </script>
</body>
</html>
